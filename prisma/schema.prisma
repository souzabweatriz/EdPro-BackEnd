generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id          Int @id @default(autoincrement())
  photo       String?
  full_name   String
  username    String?      @unique
  email       String       @unique
  phone       String?
  password    String
  role        String       @default("aluno")
  created_at  DateTime     @default(now())
  courses     courses[]
  enrollments enrollments[]
}

model courses {
  id          Int @id @default(autoincrement())
  owner_id    Int
  photo       String?
  title       String
  description String?
  category    String?
  owner       users        @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  lessons     lessons[]
  enrollments enrollments[]
}

model lessons {
  id          Int @id @default(autoincrement())
  course_id   Int
  title       String
  subtitle    String?
  content     String
  media       String?
  course      courses   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  progress  progress[]
}

model enrollments {
  id          Int @id @default(autoincrement())
  user_id     Int
  course_id   Int
  user        users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  course      courses  @relation(fields: [course_id], references: [id], onDelete: Cascade)
  progress progress[]
}

model progress {
  id             Int @id @default(autoincrement())
  enrollment_id  Int
  lesson_id      Int
  status         String    @default("incomplete")
  completed_at   DateTime  @default(now())
  enrollment     enrollments @relation(fields: [enrollment_id], references: [id], onDelete: Cascade)
  lesson         lessons     @relation(fields: [lesson_id], references: [id], onDelete: Cascade)
}